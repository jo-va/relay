version: '3'
services:
        db:
                image: mongo:latest
                ports:
                        - 27017:27017
                volumes:
                        - db-data:/data/db                        
                command: mongod --smallfiles --logpath=/dev/null

        api:
                image: api
                build:
                        context: .
                        dockerfile: Dockerfile
                        args:
                                NODE_ENV: development
                links:
                        - db
                depends_on:
                        - db
                ports:
                        - 3000:3000
                volumes:
                        - yarn:/home/node/.cache/yarn
                        - ./.babelrc:/usr/src/app/.babelrc
                        - ./.env:/usr/src/app/.env
                        - ./src:/usr/src/app/src
                        - ./build:/usr/src/app/build
                        - ./package.json:/usr/src/app/package.json
                        - ./yarn.lock:/usr/src/app/yarn.lock
                entrypoint: ["sh", "-c"]
                command: ["yarn dev"]

volumes:
        db-data:
        yarn:
